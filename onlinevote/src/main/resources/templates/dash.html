<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoteNow - Online Voting Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/dash.css}">
    <link rel="stylesheet" href="../static/css/dash.css">
    <meta name="description" content="VoteNow - Secure online voting platform dashboard">
    <meta name="theme-color" content="#4f46e5">
</head>
<body>
<div class="dashboard">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" aria-label="Main navigation">
        <div class="logo">
            <i class="fas fa-vote-yea" aria-hidden="true"></i>
            <h2>VoteNow</h2>
            <button class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="false">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
        </div>
        <ul class="nav-menu" role="menubar">
            <li class="nav-item" role="none">
                <a href="#dashboard" class="nav-link active" role="menuitem" aria-current="page" data-section="dashboard">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#elections" class="nav-link" role="menuitem" data-section="elections">
                    <i class="fas fa-vote-yea" aria-hidden="true"></i>
                    <span>Elections</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#candidates" class="nav-link" role="menuitem" data-section="candidates">
                    <i class="fas fa-users" aria-hidden="true"></i>
                    <span>Candidates</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#voters" class="nav-link" role="menuitem" data-section="voters">
                    <i class="fas fa-user-friends" aria-hidden="true"></i>
                    <span>Voters</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#voteoffice" class="nav-link" role="menuitem" data-section="voteoffice">
                    <i class="fa-solid fa-building" aria-hidden="true"></i>
                    <span>Vote Office</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#results" class="nav-link" role="menuitem" data-section="results">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i>
                    <span>Results</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#settings" class="nav-link" role="menuitem" data-section="settings">
                    <i class="fas fa-cog" aria-hidden="true"></i>
                    <span>Settings</span>
                </a>
            </li>
        </ul>
        <ul class="nav-menu logout" role="menu">
            <li class="nav-item" role="none">
                <a href="#" class="nav-link" id="logout-btn" role="menuitem">
                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header">
            <div class="search-bar">
                <label for="main-search" class="sr-only">Search elections, candidates</label>
                <i class="fas fa-search" aria-hidden="true"></i>
                <input type="search" id="main-search" placeholder="Search elections, candidates..." aria-label="Search">
            </div>
            <div class="user-profile">
                <div class="notification-bell">
                    <button class="notification-button" aria-label="Notifications" aria-expanded="false">
                        <i class="fas fa-bell" aria-hidden="true"></i>
                        <span class="notification-count">3</span>
                    </button>
                    <div class="notification-dropdown" role="menu">
                        <div class="notification-header">
                            <h4>Notifications</h4>
                            <button class="mark-all-read" aria-label="Mark all notifications as read">Mark all as read</button>
                        </div>
                        <div class="notification-item unread" role="menuitem">
                            <div class="notification-icon">
                                <i class="fas fa-vote-yea" aria-hidden="true"></i>
                            </div>
                            <div class="notification-content">
                                <p>New vote submitted for Student Council Election</p>
                                <small>2 minutes ago</small>
                            </div>
                        </div>
                        <div class="notification-item" role="menuitem">
                            <div class="notification-icon">
                                <i class="fas fa-user-plus" aria-hidden="true"></i>
                            </div>
                            <div class="notification-content">
                                <p>5 new voters registered today</p>
                                <small>1 hour ago</small>
                            </div>
                        </div>
                        <div class="notification-item" role="menuitem">
                            <div class="notification-icon">
                                <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
                            </div>
                            <div class="notification-content">
                                <p>System maintenance scheduled for tonight</p>
                                <small>3 hours ago</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-dropdown">
                    <button class="profile-button" aria-label="User profile" aria-expanded="false">
                        <img th:src="@{${user.profileImageUrl != null} ? ${user.profileImageUrl} : '/images/default-profile.png'}" alt="User profile" class="profile-img">
                        <div class="user-info">
                            <h4 th:text="${user.firstName + ' ' + user.lastName}">Super Admin</h4>
                            <p th:text="${user.role}">Admin</p>
                        </div>
                    </button>
                    <div class="dropdown-menu" role="menu">
                        <a href="#profile" role="menuitem"><i class="fas fa-user" aria-hidden="true"></i> My Profile</a>
                        <a href="#settings" role="menuitem"><i class="fas fa-cog" aria-hidden="true"></i> Settings</a>
                        <div class="divider"></div>
                        <a href="#" id="logout-dropdown-btn" role="menuitem"><i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Content (shown by default) -->
        <section id="dashboard-content" class="content-section active" aria-labelledby="dashboard-heading">
            <h2 id="dashboard-heading" class="sr-only">Dashboard Overview</h2>
            
            <!-- Dashboard Cards -->
            <div class="dashboard-cards">
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Total Voters</h3>
                            <div class="card-value" th:text="${stats.totalVoters}">2,451</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up" aria-hidden="true"></i> 
                                <span th:text="${stats.voterChangePercentage} + '% from last month'">12% from last month</span>
                            </div>
                        </div>
                        <div class="card-icon voters">
                            <i class="fas fa-user-friends" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#voters" class="card-link">View all voters</a>
                </article>
                
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Active Elections</h3>
                            <div class="card-value" th:text="${stats.activeElections}">8</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up" aria-hidden="true"></i> 
                                <span th:text="${stats.newElectionsThisWeek} + ' new this week'">2 new this week</span>
                            </div>
                        </div>
                        <div class="card-icon elections">
                            <i class="fas fa-vote-yea" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#elections" class="card-link">Manage elections</a>
                </article>
                
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Candidates</h3>
                            <div class="card-value" th:text="${stats.totalCandidates}">127</div>
                            <div class="card-change negative">
                                <i class="fas fa-arrow-down" aria-hidden="true"></i> 
                                <span th:text="${stats.withdrawnCandidates} + ' withdrawn'">3 withdrawn</span>
                            </div>
                        </div>
                        <div class="card-icon candidates">
                            <i class="fas fa-users" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#candidates" class="card-link">View candidates</a>
                </article>
                
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Completed</h3>
                            <div class="card-value" th:text="${stats.completedElections}">24</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up" aria-hidden="true"></i> 
                                <span th:text="${stats.completedThisQuarter} + ' this quarter'">5 this quarter</span>
                            </div>
                        </div>
                        <div class="card-icon completed">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#results" class="card-link">View results</a>
                </article>
            </div>

            <!-- Active Elections Section -->
            <section aria-labelledby="active-elections-heading">
                <div class="container">
                    <header>
                        <h1>Posting elections</h1>
                    </header>

                    <div class="filters">
                        <button class="filter-btn active" data-status="all">All Elections</button>
                        <button class="filter-btn" data-status="ACTIVE">Active</button>
                        <button class="filter-btn" data-status="UPCOMING">Upcoming</button>
                        <button class="filter-btn" data-status="ENDED">Ended</button>
                    </div>

                    <div class="elections-grid" id="electionsContainer">
                        <!-- Elections will be loaded here dynamically -->
                    </div>
                </div>
            </section>

            <!-- Recent Activity Section -->
            <section aria-labelledby="recent-activity-heading">
                <div class="section-header">
                    <h3 id="recent-activity-heading" class="section-title">
                        <i class="fas fa-history" aria-hidden="true"></i> Recent Activity
                    </h3>
                </div>
                <div class="activity-timeline" role="list">
                    <th:block th:each="activity : ${recentActivities}">
                        <div class="timeline-item" role="listitem">
                            <div th:class="'timeline-icon ' + ${activity.type}">
                                <i th:class="'fas ' + ${activity.icon}" aria-hidden="true"></i>
                            </div>
                            <div class="timeline-content">
                                <p th:text="${activity.message}">New vote recorded for <strong>Student Council Election</strong></p>
                                <small th:text="${#temporals.format(activity.timestamp, 'MMM d, h:mm a')}">2 minutes ago</small>
                            </div>
                        </div>
                    </th:block>
                </div>
            </section>
        </section>

        <!-- Elections Management Section -->
        <section id="elections-content" class="content-section" aria-labelledby="elections-heading">
            <div class="container">
                <header>
                    <h1 id="elections-heading">Elections Dashboard</h1>
                    <a th:href="@{/elections/new}" class="btn btn-primary" id="createElectionBtn" aria-label="Create new election">
                        <i class="fas fa-plus" aria-hidden="true"></i> Create New Election
                    </a>
                </header>

                <div class="filters" role="group" aria-label="Election filters">
                    <button class="filter-btn active" data-status="all" aria-pressed="true">All Elections</button>
                    <button class="filter-btn" data-status="active" aria-pressed="false">Active</button>
                    <button class="filter-btn" data-status="upcoming" aria-pressed="false">Upcoming</button>
                    <button class="filter-btn" data-status="ended" aria-pressed="false">Ended</button>
                </div>

                <div class="elections-grid" id="electionsContainer" aria-live="polite">
                    <th:block th:if="${elections != null and !elections.empty}">
                        <th:block th:each="election : ${elections}">
                            <article class="election-card">
                                <div class="election-banner" th:style="'background: linear-gradient(135deg, ' + ${election.color1} + ', ' + ${election.color2} + ');'">
                                    <i th:class="'fas ' + ${election.icon}" aria-hidden="true"></i>
                                    <span th:class="'election-status ' + ${election.statusClass}" 
                                          th:text="${election.status} + (${election.daysLeft} != null ? ' • ' + ${election.daysLeft} + ' days left' : '')">
                                        Active • 3 days left
                                    </span>
                                </div>
                                <div class="election-details">
                                    <h4 class="election-title" th:text="${election.title}">Student Council Election 2024</h4>
                                    <div class="election-meta">
                                        <div class="election-date">
                                            <i class="far fa-calendar-alt" aria-hidden="true"></i> 
                                            <span th:text="${#temporals.format(election.startDate, 'MMM d')} + ' - ' + ${#temporals.format(election.endDate, 'MMM d')}">May 15 - May 30</span>
                                        </div>
                                        <div><i class="fas fa-users" aria-hidden="true"></i> 
                                            <span th:text="${election.candidateCount} + ' candidates'">4 candidates</span>
                                        </div>
                                    </div>
                                    <div class="election-actions">
                                        <a th:href="@{/elections/{id}/results(id=${election.id})}" class="btn btn-outline" aria-label="View election results">
                                            <i class="fas fa-chart-bar" aria-hidden="true"></i> Results
                                        </a>
                                        <a th:href="@{/elections/{id}/manage(id=${election.id})}" class="btn btn-primary" aria-label="Manage election">
                                            <i class="fas fa-cog" aria-hidden="true"></i> Manage
                                        </a>
                                    </div>
                                </div>
                            </article>
                        </th:block>
                    </th:block>
                    <th:block th:if="${elections == null or elections.empty}">
                        <div class="no-results">
                            <i class="fas fa-calendar-times" aria-hidden="true"></i>
                            <p>No elections found</p>
                        </div>
                    </th:block>
                </div>
            </div>
        </section>

        <!-- Candidates Management Section -->
        <section id="candidates-content" class="content-section" aria-labelledby="candidates-heading">
            <div class="app-container">
                <header class="app-header">
                    <div class="container">
                        <h1 id="candidates-heading">Candidate Management</h1>
                        <div class="app-actions">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCandidateModal" aria-label="Add new candidate">
                                <i class="fas fa-plus" aria-hidden="true"></i> Add Candidate
                            </button>
                        </div>
                    </div>
                </header>

                <main class="app-main">
                    <div class="container">
                        <!-- Search and Filter -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="search-box">
                                            <label for="searchInput" class="sr-only">Search candidates</label>
                                            <i class="fas fa-search" aria-hidden="true"></i>
                                            <input type="text" class="form-control" id="searchInput" placeholder="Search candidates...">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="partyFilter" class="sr-only">Filter by party</label>
                                        <select class="form-select" id="partyFilter">
                                            <option value="">All Parties</option>
                                            <option th:each="party : ${distinctParties}" 
                                                    th:text="${party}" th:value="${party}"></option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="regionFilter" class="sr-only">Filter by region</label>
                                        <select class="form-select" id="regionFilter">
                                            <option value="">All Regions</option>
                                            <option th:each="region : ${distinctRegions}" 
                                                    th:text="${region}" th:value="${region}"></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Candidates Table -->
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="candidatesTable" aria-describedby="candidatesTableDesc">
                                        <caption id="candidatesTableDesc" class="sr-only">List of candidates with their details</caption>
                                        <thead>
                                            <tr>
                                                <th scope="col">Name</th>
                                                <th scope="col">Birthdate</th>
                                                <th scope="col">Location</th>
                                                <th scope="col">Region</th>
                                                <th scope="col">Party</th>
                                                <th scope="col">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="candidate : ${candidates}">
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar me-3">
                                                            <span th:text="${#strings.substring(candidate.firstName, 0, 1) + #strings.substring(candidate.lastName, 0, 1)}"></span>
                                                        </div>
                                                        <div>
                                                            <div class="fw-bold" th:text="${candidate.firstName + ' ' + candidate.lastName}"></div>
                                                            <div class="text-muted small" th:text="${candidate.role}"></div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div th:text="${#temporals.format(candidate.birthDate, 'dd MMM yyyy')}"></div>
                                                    <div class="text-muted small" th:text="${candidate.gender}"></div>
                                                </td>
                                                <td th:text="${candidate.location}"></td>
                                                <td th:text="${candidate.region}"></td>
                                                <td>
                                                    <span class="badge bg-primary" th:text="${candidate.party}"></span>
                                                </td>
                                                <td>
                                                    <div class="btn-group btn-group-sm" role="group" aria-label="Candidate actions">
                                                        <a th:href="@{/candidates/{id}(id=${candidate.id})}" class="btn btn-outline-primary" title="View" aria-label="View candidate">
                                                            <i class="fas fa-eye" aria-hidden="true"></i>
                                                        </a>
                                                        <a th:href="@{/candidates/{id}/edit(id=${candidate.id})}" class="btn btn-outline-secondary" title="Edit" aria-label="Edit candidate">
                                                            <i class="fas fa-pencil-alt" aria-hidden="true"></i>
                                                        </a>
                                                        <form th:action="@{/candidates/{id}(id=${candidate.id})}" method="post" style="display: inline;">
                                                            <input type="hidden" name="_method" value="DELETE">
                                                            <button type="submit" class="btn btn-outline-danger" title="Delete" aria-label="Delete candidate">
                                                                <i class="fas fa-trash" aria-hidden="true"></i>
                                                            </button>
                                                        </form>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr th:if="${candidates.empty}">
                                                <td colspan="6" class="text-center text-muted py-4">No candidates found</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>

                <footer class="app-footer">
                    <div class="container">
                        <div class="text-center text-muted">
                            &copy; <span th:text="${#temporals.format(#temporals.createToday(), 'yyyy')}">2025</span>
                            Candidate Management System
                        </div>
                    </div>
                </footer>
            </div>
        </section>

        <!-- Voters Management Section -->
        <section id="voters-content" class="content-section" aria-labelledby="voters-heading">
            <div class="container-fluid">
                <div class="row">
                    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 id="voters-heading">Voter Management</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <div class="btn-group me-2" role="group" aria-label="Export options">
                                    <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                                </div>
                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#filterModal" aria-label="Filter voters">
                                    <i class="fas fa-filter" aria-hidden="true"></i> Filters
                                </button>
                            </div>
                        </div>

                        <!-- Voter Table -->
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="votersTable" aria-describedby="votersTableDesc">
                                <caption id="votersTableDesc" class="sr-only">List of voters with their details</caption>
                                <thead>
                                    <tr>
                                        <th scope="col">Name</th>
                                        <th scope="col">Birth Date</th>
                                        <th scope="col">Gender</th>
                                        <th scope="col">Location</th>
                                        <th scope="col">Region</th>
                                        <th scope="col">Party</th>
                                        <th scope="col">Role</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="votersTableBody">
                                    <tr th:each="voter : ${voters}">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar me-3">
                                                    <span th:text="${#strings.substring(voter.firstName, 0, 1) + #strings.substring(voter.lastName, 0, 1)}"></span>
                                                </div>
                                                <div>
                                                    <div class="fw-bold" th:text="${voter.firstName + ' ' + voter.lastName}"></div>
                                                    <div class="text-muted small" th:text="${voter.email}"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td th:text="${#temporals.format(voter.birthDate, 'dd MMM yyyy')}"></td>
                                        <td th:text="${voter.gender}"></td>
                                        <td th:text="${voter.location}"></td>
                                        <td th:text="${voter.region}"></td>
                                        <td>
                                            <span class="badge bg-primary" th:text="${voter.party != null} ? ${voter.party} : 'None'">None</span>
                                        </td>
                                        <td th:text="${voter.role}"></td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group" aria-label="Voter actions">
                                                <button class="btn btn-outline-primary view-voter" 
                                                        th:attr="data-id=${voter.id}" title="View" aria-label="View voter">
                                                    <i class="fas fa-eye" aria-hidden="true"></i>
                                                </button>
                                                <a th:href="@{/voters/{id}/edit(id=${voter.id})}" class="btn btn-outline-secondary" title="Edit" aria-label="Edit voter">
                                                    <i class="fas fa-pencil-alt" aria-hidden="true"></i>
                                                </a>
                                                <form th:action="@{/voters/{id}(id=${voter.id})}" method="post" style="display: inline;">
                                                    <input type="hidden" name="_method" value="DELETE">
                                                    <button type="submit" class="btn btn-outline-danger" title="Delete" aria-label="Delete voter">
                                                        <i class="fas fa-trash" aria-hidden="true"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Voters pagination" th:if="${totalPages > 1}">
                            <ul class="pagination justify-content-center">
                                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                                    <a class="page-link" th:href="@{/voters(page=1)}" aria-label="First">
                                        <span aria-hidden="true">&laquo;&laquo;</span>
                                    </a>
                                </li>
                                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                                    <a class="page-link" th:href="@{/voters(page=${currentPage-1})}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                
                                <th:block th:each="page : ${#numbers.sequence(1, totalPages)}">
                                    <li class="page-item" th:classappend="${currentPage == page} ? 'active'">
                                        <a class="page-link" th:href="@{/voters(page=${page})}" th:text="${page}"></a>
                                    </li>
                                </th:block>
                                
                                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                                    <a class="page-link" th:href="@{/voters(page=${currentPage+1})}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                                    <a class="page-link" th:href="@{/voters(page=${totalPages})}" aria-label="Last">
                                        <span aria-hidden="true">&raquo;&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </main>
                </div>
            </div>
        </section>

        <!-- Vote Office section -->
        <section id="voteoffice-content" class="content-section" aria-labelledby="voteoffice-heading">
            <div class="container">
                <header>
                    <h1 id="voteoffice-heading">Vote Offices Management</h1>
                    <a href="#" class="btn btn-primary" id="addOfficeBtn" aria-label="Add new vote office">
                        <i class="fas fa-plus" aria-hidden="true"></i> Add New Office
                    </a>
                </header>
                
                <div class="controls">
                    <div class="search-bar">
                        <label for="officeSearchInput" class="sr-only">Search offices</label>
                        <i class="fas fa-search" aria-hidden="true"></i>
                        <input type="text" id="officeSearchInput" placeholder="Search offices...">
                    </div>
                </div>
                
                <div class="offices-grid" id="officesContainer" aria-live="polite">
                    <th:block th:each="office : ${offices}">
                        <article class="office-card">
                            <div class="office-header">
                                <h3 th:text="${office.name}">Main Voting Office</h3>
                                <span class="badge" th:classappend="${office.status == 'ACTIVE'} ? 'bg-success' : 'bg-secondary'"
                                      th:text="${office.status}">ACTIVE</span>
                            </div>
                            <div class="office-details">
                                <div class="detail-item">
                                    <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                    <span th:text="${office.location}">123 Main St, City</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-phone" aria-hidden="true"></i>
                                    <span th:text="${office.phone}">+1 (555) 123-4567</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-user" aria-hidden="true"></i>
                                    <span th:text="${office.managerName}">John Doe</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-calendar" aria-hidden="true"></i>
                                    <span th:text="${#temporals.format(office.openingDate, 'MMM d, yyyy')}">Jan 1, 2023</span>
                                </div>
                            </div>
                            <div class="office-actions">
                                <a th:href="@{/offices/{id}/edit(id=${office.id})}" class="btn btn-outline" aria-label="Edit office">
                                    <i class="fas fa-pencil-alt" aria-hidden="true"></i> Edit
                                </a>
                                <a th:href="@{/offices/{id}(id=${office.id})}" class="btn btn-primary" aria-label="View office details">
                                    <i class="fas fa-info-circle" aria-hidden="true"></i> Details
                                </a>
                            </div>
                        </article>
                    </th:block>
                </div>
                
                <nav aria-label="Vote offices pagination" th:if="${officeTotalPages > 1}">
                    <ul class="pagination" id="officePagination">
                        <li class="page-item" th:classappend="${officeCurrentPage == 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/offices(page=1)}" aria-label="First">
                                <span aria-hidden="true">&laquo;&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item" th:classappend="${officeCurrentPage == 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/offices(page=${officeCurrentPage-1})}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        
                        <th:block th:each="page : ${#numbers.sequence(1, officeTotalPages)}">
                            <li class="page-item" th:classappend="${officeCurrentPage == page} ? 'active'">
                                <a class="page-link" th:href="@{/offices(page=${page})}" th:text="${page}"></a>
                            </li>
                        </th:block>
                        
                        <li class="page-item" th:classappend="${officeCurrentPage == officeTotalPages} ? 'disabled'">
                            <a class="page-link" th:href="@{/offices(page=${officeCurrentPage+1})}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        <li class="page-item" th:classappend="${officeCurrentPage == officeTotalPages} ? 'disabled'">
                            <a class="page-link" th:href="@{/offices(page=${officeTotalPages})}" aria-label="Last">
                                <span aria-hidden="true">&raquo;&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results-content" class="content-section" aria-labelledby="results-heading">
            <div class="container">
                <div class="section-header">
                    <h1 id="results-heading">Election Results</h1>
                    <div class="export-actions">
                        <button class="btn btn-outline" aria-label="Export results as PDF">
                            <i class="fas fa-file-pdf" aria-hidden="true"></i> Export PDF
                        </button>
                        <button class="btn btn-outline" aria-label="Export results as CSV">
                            <i class="fas fa-file-excel" aria-hidden="true"></i> Export CSV
                        </button>
                    </div>
                </div>

                <div class="results-filter">
                    <label for="electionSelect" class="sr-only">Select election</label>
                    <select class="election-select" id="electionSelect">
                        <option value="">Select an election</option>
                        <option th:each="election : ${pastElections}" 
                                th:value="${election.id}" 
                                th:text="${election.title + ' (' + #temporals.format(election.endDate, 'yyyy') + ')'}">
                            Student Council Election 2024
                        </option>
                    </select>
                </div>

                <div class="results-container" th:if="${selectedElection != null}">
                    <div class="results-summary">
                        <article class="summary-card">
                            <h3>Total Votes</h3>
                            <div class="summary-value" th:text="${selectedElection.totalVotes}">782</div>
                            <div class="summary-meta" th:text="${selectedElection.participationRate} + '% participation'">62% participation</div>
                        </article>
                        <article class="summary-card">
                            <h3>Valid Votes</h3>
                            <div class="summary-value" th:text="${selectedElection.validVotes}">765</div>
                            <div class="summary-meta" th:text="${#numbers.formatDecimal(selectedElection.validVotes/selectedElection.totalVotes*100, 1, 1)} + '% of total'">97.8% of total</div>
                        </article>
                        <article class="summary-card">
                            <h3>Invalid Votes</h3>
                            <div class="summary-value" th:text="${selectedElection.invalidVotes}">17</div>
                            <div class="summary-meta" th:text="${#numbers.formatDecimal(selectedElection.invalidVotes/selectedElection.totalVotes*100, 1, 1)} + '% of total'">2.2% of total</div>
                        </article>
                    </div>

                    <div class="results-chart">
                        <div class="chart-header">
                            <h3 th:text="${selectedElection.mainPosition} + ' - Vote Distribution'">President - Vote Distribution</h3>
                            <div class="chart-legend" role="list">
                                <th:block th:each="candidate : ${selectedElection.candidates}">
                                    <div class="legend-item" role="listitem">
                                        <span class="legend-color" th:style="'background-color: ' + ${candidate.color} + ';'"></span>
                                        <span th:text="${candidate.name} + ' (' + ${candidate.percentage} + '%)'">Michael Chen (43.7%)</span>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                        <div class="chart-container" role="img" aria-label="Vote distribution chart">
                            <canvas id="resultsChart" width="400" height="200"></canvas>
                            <noscript>
                                <p>Vote distribution: 
                                    <th:block th:each="candidate : ${selectedElection.candidates}">
                                        <span th:text="${candidate.name} + ' ' + ${candidate.percentage} + '%'">Michael Chen 43.7%</span>
                                        <span th:unless="${candidateStat.last}">, </span>
                                    </th:block>
                                </p>
                            </noscript>
                        </div>
                    </div>

                    <div class="results-table">
                        <table aria-describedby="resultsTableDesc">
                            <caption id="resultsTableDesc" class="sr-only">Election results by position</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Position</th>
                                    <th scope="col">Winner</th>
                                    <th scope="col">Votes</th>
                                    <th scope="col">Percentage</th>
                                    <th scope="col">Margin</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="position : ${selectedElection.positions}">
                                    <th scope="row" th:text="${position.name}">President</th>
                                    <td>
                                        <div class="candidate-info">
                                            <img th:src="${position.winnerImageUrl}" alt="Winner photo">
                                            <span th:text="${position.winnerName}">Michael Chen</span>
                                        </div>
                                    </td>
                                    <td th:text="${position.winnerVotes}">342</td>
                                    <td th:text="${position.winnerPercentage} + '%'">43.7%</td>
                                    <td th:text="'+' + ${position.voteMargin} + ' votes'">+53 votes</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-content" class="content-section" aria-labelledby="settings-heading">
            <div class="section-header">
                <h3 id="settings-heading" class="section-title">
                    <i class="fas fa-cog" aria-hidden="true"></i> Settings
                </h3>
            </div>
            <div class="settings-content">
                <div class="settings-tabs" role="tablist" aria-label="Settings tabs">
                    <button class="settings-tab active" data-tab="account" role="tab" aria-selected="true" aria-controls="account-tab">Account</button>
                    <button class="settings-tab" data-tab="security" role="tab" aria-selected="false" aria-controls="security-tab">Security</button>
                    <button class="settings-tab" data-tab="notifications" role="tab" aria-selected="false" aria-controls="notifications-tab">Notifications</button>
                    <button class="settings-tab" data-tab="system" role="tab" aria-selected="false" aria-controls="system-tab">System</button>
                </div>

                <div class="settings-tab-content active" id="account-tab" role="tabpanel" aria-labelledby="account-tab" data-tab="account">
                    <div class="settings-card">
                        <h4><i class="fas fa-user-shield" aria-hidden="true"></i> Account Settings</h4>
                        <form th:action="@{/settings/account}" method="post" class="settings-form">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" th:value="${user.username}" readonly>
                            </div>
                            <div class="form-group">
                                <label for="fullname">Full Name</label>
                                <input type="text" id="fullname" th:value="${user.firstName + ' ' + user.lastName}">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" th:value="${user.email}">
                            </div>
                            <div class="form-group">
                                <label>Profile Photo</label>
                                <div class="file-upload">
                                    <img th:src="@{${user.profileImageUrl != null} ? ${user.profileImageUrl} : '/images/default-profile.png'}" alt="Current profile" class="profile-preview">
                                    <div class="upload-actions">
                                        <button type="button" class="btn btn-outline btn-sm" aria-label="Change profile photo">
                                            <i class="fas fa-camera" aria-hidden="true"></i> Change
                                        </button>
                                        <button type="button" class="btn btn-outline btn-sm" aria-label="Remove profile photo">
                                            <i class="fas fa-trash" aria-hidden="true"></i> Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Account</button>
                        </form>
                    </div>
                </div>

                <div class="settings-tab-content" id="security-tab" role="tabpanel" aria-labelledby="security-tab" data-tab="security">
                    <div class="settings-card">
                        <h4><i class="fas fa-lock" aria-hidden="true"></i> Security</h4>
                        <form th:action="@{/settings/security}" method="post" class="settings-form">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" placeholder="Enter current password" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" placeholder="Enter new password" required>
                                <small class="form-text">Password must be at least 8 characters long</small>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                            </div>
                            <div class="form-group">
                                <label for="2fa-toggle">Two-Factor Authentication</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="2fa-toggle" th:checked="${user.twoFactorEnabled}">
                                    <label for="2fa-toggle"></label>
                                    <span th:text="${user.twoFactorEnabled} ? 'Enabled' : 'Disabled'">Enabled</span>
                                </div>
                                <small class="form-text">Add an extra layer of security to your account</small>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Security Settings</button>
                        </form>
                    </div>
                </div>

                <div class="settings-tab-content" id="notifications-tab" role="tabpanel" aria-labelledby="notifications-tab" data-tab="notifications">
                    <div class="settings-card">
                        <h4><i class="fas fa-bell" aria-hidden="true"></i> Notification Preferences</h4>
                        <form th:action="@{/settings/notifications}" method="post" class="settings-options">
                            <div class="option-group">
                                <h5>Email Notifications</h5>
                                <div class="option-item">
                                    <input type="checkbox" id="email-election" th:checked="${user.notificationPreferences.emailElection}">
                                    <label for="email-election">Election updates</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="email-results" th:checked="${user.notificationPreferences.emailResults}">
                                    <label for="email-results">Election results</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="email-system" th:checked="${user.notificationPreferences.emailSystem}">
                                    <label for="email-system">System notifications</label>
                                </div>
                            </div>
                            <div class="option-group">
                                <h5>In-App Notifications</h5>
                                <div class="option-item">
                                    <input type="checkbox" id="app-new-voter" th:checked="${user.notificationPreferences.appNewVoter}">
                                    <label for="app-new-voter">New voter registrations</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="app-new-candidate" th:checked="${user.notificationPreferences.appNewCandidate}">
                                    <label for="app-new-candidate">New candidate applications</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="app-vote-activity" th:checked="${user.notificationPreferences.appVoteActivity}">
                                    <label for="app-vote-activity">Vote activity</label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Preferences</button>
                        </form>
                    </div>
                </div>

                <div class="settings-tab-content" id="system-tab" role="tabpanel" aria-labelledby="system-tab" data-tab="system">
                    <div class="settings-card">
                        <h4><i class="fas fa-server" aria-hidden="true"></i> System Settings</h4>
                        <form th:action="@{/settings/system}" method="post" class="settings-form">
                            <div class="form-group">
                                <label for="timezone">Timezone</label>
                                <select id="timezone" th:value="${systemSettings.timezone}">
                                    <option th:each="tz : ${timezones}" 
                                            th:value="${tz.id}" 
                                            th:text="${tz.displayName}"
                                            th:selected="${tz.id == systemSettings.timezone}">
                                        (UTC-05:00) Eastern Time (US & Canada)
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dateFormat">Date Format</label>
                                <select id="dateFormat" th:value="${systemSettings.dateFormat}">
                                    <option th:each="format : ${dateFormats}" 
                                            th:value="${format}" 
                                            th:text="${format}"
                                            th:selected="${format == systemSettings.dateFormat}">
                                        MM/DD/YYYY
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="resultsVisibility">Results Visibility</label>
                                <select id="resultsVisibility" th:value="${systemSettings.resultsVisibility}">
                                    <option th:each="visibility : ${visibilityOptions}" 
                                            th:value="${visibility.key}" 
                                            th:text="${visibility.value}"
                                            th:selected="${visibility.key == systemSettings.resultsVisibility}">
                                        Show after election ends
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="electionDuration">Default Election Duration</label>
                                <input type="number" id="electionDuration" th:value="${systemSettings.defaultElectionDuration}" min="1" max="30">
                                <small class="form-text">Days</small>
                            </div>
                            <button type="submit" class="btn btn-primary">Save System Settings</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Add Candidate Modal -->
<div class="modal fade" id="addCandidateModal" tabindex="-1" role="dialog" aria-labelledby="addCandidateModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCandidateModalTitle">Add New Candidate</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="candidateForm" th:action="@{/candidates}" method="post" novalidate>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="firstname" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstname" name="firstName" required>
                            <div class="invalid-feedback">Please provide a first name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="lastname" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastname" name="lastName" required>
                            <div class="invalid-feedback">Please provide a last name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="birthdate" class="form-label">Birthdate</label>
                            <input type="date" class="form-control" id="birthdate" name="birthDate">
                        </div>
                        <div class="col-md-6">
                            <label for="gender" class="form-label">Gender</label>
                            <select class="form-select" id="gender" name="gender">
                                <option value="">Select Gender</option>
                                <option th:each="gender : ${genders}" 
                                        th:value="${gender}" 
                                        th:text="${gender}">
                                    Male
                                </option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="party" class="form-label">Political Party</label>
                            <input type="text" class="form-control" id="party" name="party">
                        </div>
                        <div class="col-md-6">
                            <label for="role" class="form-label">Role</label>
                            <select class="form-select" id="role" name="role">
                                <option th:each="role : ${candidateRoles}" 
                                        th:value="${role.key}" 
                                        th:text="${role.value}">
                                    Candidate
                                </option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="region" class="form-label">Region</label>
                            <input type="text" class="form-control" id="region" name="region">
                        </div>
                        <div class="col-md-4">
                            <label for="department" class="form-label">Department</label>
                            <input type="text" class="form-control" id="department" name="department">
                        </div>
                        <div class="col-md-4">
                            <label for="arron" class="form-label">Arron</label>
                            <input type="text" class="form-control" id="arron" name="arron">
                        </div>
                        <div class="col-12">
                            <label for="location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="location" name="location">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="candidateForm" class="btn btn-primary">Save Candidate</button>
            </div>
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">Filter Voters</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="filterForm">
                    <div class="mb-3">
                        <label for="voterRegionFilter" class="form-label">Region</label>
                        <select class="form-select" id="voterRegionFilter">
                            <option value="">All Regions</option>
                            <option th:each="region : ${regions}" th:value="${region}" th:text="${region}"></option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="voterPartyFilter" class="form-label">Political Party</label>
                        <select class="form-select" id="voterPartyFilter">
                            <option value="">All Parties</option>
                            <option th:each="party : ${parties}" th:value="${party}" th:text="${party}"></option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="voterGenderFilter" class="form-label">Gender</label>
                        <select class="form-select" id="voterGenderFilter">
                            <option value="">All Genders</option>
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="applyFilters">Apply Filters</button>
            </div>
        </div>
    </div>
</div>

<!-- Voter Details Modal -->
<div class="modal fade" id="voterDetailsModal" tabindex="-1" role="dialog" aria-labelledby="voterDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="voterDetailsModalLabel">Voter Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="voterDetailsContent">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Create Election Modal -->
<div class="modal" id="createElectionModal" tabindex="-1" role="dialog" aria-labelledby="createElectionModalTitle" aria-hidden="true">
    <div class="modal-content" role="document">
        <div class="modal-header">
            <h3 id="createElectionModalTitle">Create New Election</h3>
            <button class="modal-close" aria-label="Close modal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="electionForm" th:action="@{/elections}" method="post" novalidate>
                <div class="form-group">
                    <label for="electionTitle">Election Title</label>
                    <input type="text" id="electionTitle" name="title" placeholder="Enter election title" required>
                    <div class="invalid-feedback">Please provide a title for the election.</div>
                </div>
                <div class="form-group">
                    <label for="electionDescription">Description</label>
                    <textarea id="electionDescription" name="description" placeholder="Enter election description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="electionStartDate">Start Date</label>
                        <input type="datetime-local" id="electionStartDate" name="startDate" required>
                        <div class="invalid-feedback">Please select a start date.</div>
                    </div>
                    <div class="form-group">
                        <label for="electionEndDate">End Date</label>
                        <input type="datetime-local" id="electionEndDate" name="endDate" required>
                        <div class="invalid-feedback">Please select an end date.</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="electionType">Election Type</label>
                    <select id="electionType" name="type">
                        <option th:each="type : ${electionTypes}" 
                                th:value="${type.key}" 
                                th:text="${type.value}">
                            Single Choice
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="eligibleVoters">Eligible Voters</label>
                    <select id="eligibleVoters" name="eligibleGroups" multiple>
                        <option th:each="group : ${voterGroups}" 
                                th:value="${group.id}" 
                                th:text="${group.name}">
                            All registered voters
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="electionBanner">Election Banner</label>
                    <div class="file-upload">
                        <label for="bannerUpload" class="upload-prompt">
                            <i class="fas fa-image" aria-hidden="true"></i>
                            <p>Click to upload banner image</p>
                        </label>
                        <input type="file" id="bannerUpload" name="bannerImage" accept="image/*">
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-cancel" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" form="electionForm" class="btn btn-primary">Create Election</button>
        </div>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div class="modal" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="logoutModalTitle" aria-hidden="true">
    <div class="modal-content small" role="document">
        <div class="modal-header">
            <h3 id="logoutModalTitle">Confirm Logout</h3>
            <button class="modal-close" aria-label="Close modal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to logout from your account?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline modal-cancel" data-bs-dismiss="modal">Cancel</button>
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn btn-primary" id="confirmLogout">Logout</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:src="@{/js/dash.js}"></script>
<script src="../static/js/dash.js"></script>
<script>
    // Initialize chart if results section is active
    document.addEventListener('DOMContentLoaded', function() {
        if(document.getElementById('results-content').classList.contains('active')) {
            initResultsChart();
        }
        
        // Add event listener for election select change
        document.getElementById('electionSelect').addEventListener('change', function() {
            window.location.href = '/results?electionId=' + this.value;
        });
    });

    function initResultsChart() {
        const ctx = document.getElementById('resultsChart').getContext('2d');
        const chartData = {
            labels: [
                <th:block th:each="candidate : ${selectedElection.candidates}">
                    '<span th:text="${candidate.name}"></span>',
                </th:block>
            ],
            datasets: [{
                data: [
                    <th:block th:each="candidate : ${selectedElection.candidates}">
                        <span th:text="${candidate.votes}"></span>,
                    </th:block>
                ],
                backgroundColor: [
                    <th:block th:each="candidate : ${selectedElection.candidates}">
                        '<span th:text="${candidate.color}"></span>',
                    </th:block>
                ],
                borderWidth: 1
            }]
        };
        
        new Chart(ctx, {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
    
    // Voter details modal
    document.querySelectorAll('.view-voter').forEach(button => {
        button.addEventListener('click', function() {
            const voterId = this.getAttribute('data-id');
            fetch('/voters/' + voterId + '/details')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('voterDetailsContent').innerHTML = html;
                    new bootstrap.Modal(document.getElementById('voterDetailsModal')).show();
                });
        });
    });
</script>
</body>
</html>