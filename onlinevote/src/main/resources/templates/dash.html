<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoteNow - Online Voting Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/dash.css}">
    <link rel="stylesheet" href="../static/css/dash.css">
    <meta name="description" content="VoteNow - Secure online voting platform dashboard">
    <meta name="theme-color" content="#4f46e5">
</head>
<body>
<div class="dashboard">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" aria-label="Main navigation">
        <div class="logo">
            <i class="fas fa-vote-yea" aria-hidden="true"></i>
            <h2>VoteNow</h2>
            <button class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="false">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
        </div>
        <ul class="nav-menu" role="menubar">
            <li class="nav-item" role="none">
                <a href="#dashboard" class="nav-link active" role="menuitem" aria-current="page" data-section="dashboard">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#elections" class="nav-link" role="menuitem" data-section="elections">
                    <i class="fas fa-vote-yea" aria-hidden="true"></i>
                    <span>Elections</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#candidates" class="nav-link" role="menuitem" data-section="candidates">
                    <i class="fas fa-users" aria-hidden="true"></i>
                    <span>Candidates</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#voters" class="nav-link" role="menuitem" data-section="voters">
                    <i class="fas fa-user-friends" aria-hidden="true"></i>
                    <span>Voters</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#voteoffice" class="nav-link" role="menuitem" data-section="voteoffice">
                    <i class="fa-solid fa-building" aria-hidden="true"></i>
                    <span>Vote Office</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#results" class="nav-link" role="menuitem" data-section="results">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i>
                    <span>Results</span>
                </a>
            </li>
            <li class="nav-item" role="none">
                <a href="#settings" class="nav-link" role="menuitem" data-section="settings">
                    <i class="fas fa-cog" aria-hidden="true"></i>
                    <span>Settings</span>
                </a>
            </li>
        </ul>
        <ul class="nav-menu logout" role="menu">
            <li class="nav-item" role="none">
                <a href="#" class="nav-link" id="logout-btn" role="menuitem">
                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header">
            <div class="search-bar">
                <label for="main-search" class="sr-only">Search elections, candidates</label>
                <i class="fas fa-search" aria-hidden="true"></i>
                <input type="search" id="main-search" placeholder="Search elections, candidates..." aria-label="Search">
            </div>
            <!-- <div class="user-profile">
                <div class="profile-dropdown">
                    <button class="profile-btn" aria-expanded="false" aria-label="User profile menu">
                        <img th:src="@{/images/profile.png'}" alt="User profile">
                        <span th:text="${user.firstName} + ' ' + ${user.lastName}">Admin User</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#settings" role="menuitem"><i class="fas fa-user-cog"></i> Profile Settings</a></li>
                        <li><a href="#" role="menuitem"><i class="fas fa-question-circle"></i> Help</a></li>
                        <li><a href="#" id="logout-btn" role="menuitem"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                    </ul>
                </div>
            </div> -->
        </header>

        <!-- Dashboard Content (shown by default) -->
        <section id="dashboard-content" class="content-section active" aria-labelledby="dashboard-heading">
            <h2 id="dashboard-heading" class="sr-only">Dashboard Overview</h2>
            
            <!-- Dashboard Cards -->
            <div class="dashboard-cards">
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Total Voters</h3>
                            <div class="card-value" text="#">2,451</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up" aria-hidden="true"></i> 
                                <span text="#">12% from last month</span>
                            </div>
                        </div>
                        <div class="card-icon voters">
                            <i class="fas fa-user-friends" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#voters" class="card-link">View all voters</a>
                </article>
                
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Active Elections</h3>
                            <div class="card-value" text="${stats.activeElections}">8</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up" aria-hidden="true"></i> 
                                <span text="${stats.newElectionsThisWeek} + ' new this week'">2 new this week</span>
                            </div>
                        </div>
                        <div class="card-icon elections">
                            <i class="fas fa-vote-yea" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#elections" class="card-link">Manage elections</a>
                </article>
                
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Candidates</h3>
                            <div class="card-value" text="#">127</div>
                            <div class="card-change negative">
                                <i class="fas fa-arrow-down" aria-hidden="true"></i> 
                                <span text="#">3 withdrawn</span>
                            </div>
                        </div>
                        <div class="card-icon candidates">
                            <i class="fas fa-users" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#candidates" class="card-link">View candidates</a>
                </article>
                
                <article class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Completed</h3>
                            <div class="card-value" text="${stats.completedElections}">24</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up" aria-hidden="true"></i> 
                                <span text="${stats.completedThisQuarter} + ' this quarter'">5 this quarter</span>
                            </div>
                        </div>
                        <div class="card-icon completed">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                        </div>
                    </div>
                    <a href="#results" class="card-link">View results</a>
                </article>
            </div>

            <!-- Active Elections Section -->
            <section aria-labelledby="active-elections-heading">
                <div class="section-header">
                    <h3 id="active-elections-heading">
                        <i class="fas fa-vote-yea"></i> Active Elections
                    </h3>
                    <a href="#elections" class="view-all">View All <i class="fas fa-chevron-right"></i></a>
                </div>

                <div class="filters">
                    <button class="filter-btn active" data-status="all">All Elections</button>
                    <button class="filter-btn" data-status="ACTIVE">Active</button>
                    <button class="filter-btn" data-status="UPCOMING">Upcoming</button>
                    <button class="filter-btn" data-status="ENDED">Ended</button>
                </div>

                <div class="elections-grid" id="electionsContainer">
                    <!-- Elections will be loaded here dynamically -->
                    <div class="skeleton-loader">
                        <div class="skeleton-banner"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-title"></div>
                            <div class="skeleton-meta"></div>
                            <div class="skeleton-meta"></div>
                            <div class="skeleton-actions"></div>
                        </div>
                    </div>
                    <div class="skeleton-loader">
                        <div class="skeleton-banner"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-title"></div>
                            <div class="skeleton-meta"></div>
                            <div class="skeleton-meta"></div>
                            <div class="skeleton-actions"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Activity Section -->
            <section aria-labelledby="recent-activity-heading">
                <div class="section-header">
                    <h3 id="recent-activity-heading" class="section-title">
                        <i class="fas fa-history" aria-hidden="true"></i> Recent Activity
                    </h3>
                    <button class="btn btn-refresh" aria-label="Refresh activities">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="activity-timeline" role="list">
                    <th:block th:each="activity : ${recentActivities}">
                        <div class="timeline-item" role="listitem">
                            <div th:class="'timeline-icon ' + ${activity.type}">
                                <i th:class="'fas ' + ${activity.icon}" aria-hidden="true"></i>
                            </div>
                            <div class="timeline-content">
                                <p th:text="${activity.message}">New vote recorded for <strong>Student Council Election</strong></p>
                                <small th:text="${#temporals.format(activity.timestamp, 'MMM d, h:mm a')}">2 minutes ago</small>
                            </div>
                        </div>
                    </th:block>
                    <div class="timeline-item empty-state" th:if="${recentActivities == null or recentActivities.empty}">
                        <div class="timeline-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="timeline-content">
                            <p>No recent activities found</p>
                        </div>
                    </div>
                </div>
            </section>
        </section>

        <!-- Elections Management Section -->
        <section id="elections-content" class="content-section" aria-labelledby="elections-heading">
            <div class="container">
                <header>
                    <h1 id="elections-heading">Elections Dashboard</h1>
                    <div class="header-actions">
                        <a th:href="@{/elections/new}" class="btn btn-primary" id="createElectionBtn" aria-label="Create new election">
                            <i class="fas fa-plus" aria-hidden="true"></i> Create New Election
                        </a>
                        <button class="btn btn-outline" id="refreshElections">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </header>

                <div class="filters" role="group" aria-label="Election filters">
                    <button class="filter-btn active" data-status="all" aria-pressed="true">All Elections</button>
                    <button class="filter-btn" data-status="active" aria-pressed="false">Active</button>
                    <button class="filter-btn" data-status="upcoming" aria-pressed="false">Upcoming</button>
                    <button class="filter-btn" data-status="ended" aria-pressed="false">Ended</button>
                    <button class="filter-btn" data-status="draft" aria-pressed="false">Drafts</button>
                </div>

                <div class="elections-grid" id="electionsContainer" aria-live="polite">
                    <th:block th:if="${elections != null and !elections.empty}">
                        <th:block th:each="election : ${elections}">
                            <article class="election-card">
                                <div class="election-banner" th:style="'background: linear-gradient(135deg, ' + ${election.color1} + ', ' + ${election.color2} + ');'">
                                    <i th:class="'fas ' + ${election.icon}" aria-hidden="true"></i>
                                    <span th:class="'election-status ' + ${election.statusClass}" 
                                          th:text="${election.status} + (${election.daysLeft} != null ? ' • ' + ${election.daysLeft} + ' days left' : '')">
                                        Active • 3 days left
                                    </span>
                                </div>
                                <div class="election-details">
                                    <h4 class="election-title" th:text="${election.title}">Student Council Election 2024</h4>
                                    <div class="election-meta">
                                        <div class="election-date">
                                            <i class="far fa-calendar-alt" aria-hidden="true"></i> 
                                            <span th:text="${#temporals.format(election.startDate, 'MMM d')} + ' - ' + ${#temporals.format(election.endDate, 'MMM d')}">May 15 - May 30</span>
                                        </div>
                                        <div><i class="fas fa-users" aria-hidden="true"></i> 
                                            <span th:text="${election.candidateCount} + ' candidates'">4 candidates</span>
                                        </div>
                                    </div>
                                    <div class="election-actions">
                                        <a th:href="@{/elections/{id}/results(id=${election.id})}" class="btn btn-outline" aria-label="View election results">
                                            <i class="fas fa-chart-bar" aria-hidden="true"></i> Results
                                        </a>
                                        <a th:href="@{/elections/{id}/manage(id=${election.id})}" class="btn btn-primary" aria-label="Manage election">
                                            <i class="fas fa-cog" aria-hidden="true"></i> Manage
                                        </a>
                                    </div>
                                </div>
                            </article>
                        </th:block>
                    </th:block>
                    <th:block th:if="${elections == null or elections.empty}">
                        <div class="no-results">
                            <i class="fas fa-calendar-times" aria-hidden="true"></i>
                            <p>No elections found</p>
                            <a th:href="@{/elections/new}" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Create Your First Election
                            </a>
                        </div>
                    </th:block>
                </div>
            </div>
        </section>

        <!-- Candidates Management Section -->
        <section id="candidates-content" class="content-section" aria-labelledby="candidates-heading">
            <div class="app-container">
                <header class="app-header">
                    <div class="container">
                        <h1 id="candidates-heading">Candidate Management</h1>
                        <div class="app-actions">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCandidateModal" aria-label="Add new candidate">
                                <i class="fas fa-plus" aria-hidden="true"></i> Add Candidate
                            </button>
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="candidateSearch" placeholder="Search candidates...">
                            </div>
                        </div>
                    </div>
                </header>

                <div class="container my-4">
                    <div class="filters">
                        <select id="candidatePartyFilter" class="form-select">
                            <option value="">All Parties</option>
                            <option th:each="party : ${parties}" th:value="${party}">[[${party}]]</option>
                        </select>
                        <select id="candidateStatusFilter" class="form-select">
                            <option value="">All Statuses</option>
                            <option value="ACTIVE">Active</option>
                            <option value="WITHDRAWN">Withdrawn</option>
                            <option value="PENDING">Pending</option>
                        </select>
                        <select id="candidateElectionFilter" class="form-select">
                            <option value="">All Elections</option>
                            <option th:each="election : ${activeElections}" 
                                    th:value="${election.id}" 
                                    th:text="${election.title}">
                            </option>
                        </select>
                    </div>
                </div>

                <main class="container my-5">
                    <!-- Loading Indicator -->
                    <div id="loadingIndicator" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Loading candidates...</p>
                    </div>

                    <!-- Candidate Grid -->
                    <div id="candidateGrid" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        <!-- Candidates will be inserted here by JavaScript -->
                    </div>

                    <!-- No Results Message -->
                    <div id="noResults" class="text-center py-5 d-none">
                        <i class="fas fa-user-slash fa-3x mb-3 text-muted"></i>
                        <h3>No candidates found</h3>
                        <p class="text-muted">Try adjusting your search or filters</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCandidateModal">
                            <i class="fas fa-plus"></i> Add New Candidate
                        </button>
                    </div>

                    <!-- Pagination -->
                    <nav id="pagination" class="mt-5 d-flex justify-content-center d-none">
                        <ul class="pagination">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Next</a>
                            </li>
                        </ul>
                    </nav>
                </main>
            </div>
        </section>

        <!-- Voters Management Section -->
        <section id="voters-content" class="content-section" aria-labelledby="voters-heading">
            <header class="voter-header">
                <div class="container py-5">
                    <h1 class="display-4 text-white mb-4">Voter Registry</h1>
                    <p class="lead text-white mb-5">Manage and view registered voters in the system</p>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchInput" class="form-control" placeholder="Search voters...">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select id="regionFilter" class="form-select">
                                <option value="">All Regions</option>
                                <option th:each="region : ${regions}" th:value="${region}">[[${region}]]</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="roleFilter" class="form-select">
                                <option value="">All Roles</option>
                                <option value="ADMIN">Admin</option>
                                <option value="OFFICIAL">Election Official</option>
                                <option value="VOTER">Voter</option>
                            </select>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="container my-5">
                <!-- Loading Indicator -->
                <div id="loadingIndicator" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading voters...</p>
                </div>

                <!-- Voter Grid -->
                <div id="voterGrid" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    <!-- Voters will be inserted here by JavaScript -->
                </div>

                <!-- No Results Message -->
                <div id="noResults" class="text-center py-5 d-none">
                    <i class="fas fa-user-slash fa-3x mb-3 text-muted"></i>
                    <h3>No voters found</h3>
                    <p class="text-muted">Try adjusting your search or filters</p>
                </div>

                <!-- Pagination -->
                <nav id="pagination" class="mt-5 d-flex justify-content-center d-none">
                    <ul class="pagination">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">Next</a>
                        </li>
                    </ul>
                </nav>
            </main>
        </section>

        <!-- Vote Office section -->
        <section id="voteoffice-content" class="content-section" aria-labelledby="voteoffice-heading">
            <div class="container">
                <header>
                    <h1 id="voteoffice-heading">Vote Offices Management</h1>
                    <div class="header-actions">
                        <a href="#" class="btn btn-primary" id="addOfficeBtn" aria-label="Add new vote office">
                            <i class="fas fa-plus" aria-hidden="true"></i> Add New Office
                        </a>
                        <button class="btn btn-outline" id="refreshOffices">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </header>
                
               <div class="container">
                    <div class="controls">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="officeSearchInput" placeholder="Search offices...">
                        </div>
                        <select id="officeRegionFilter" class="form-select">
                            <option value="">All Regions</option>
                            <option th:each="region : ${regions}" th:value="${region}">[[${region}]]</option>
                        </select>
                    </div>
                    
                    <div class="offices-grid" id="officesContainer">
                        <!-- Offices will be loaded here dynamically -->
                    </div>
                    
                    <div class="pagination" id="pagination">
                        <!-- Pagination will be loaded here dynamically -->
                    </div>
               </div>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results-content" class="content-section" aria-labelledby="results-heading">
            <div class="container">
                <div class="section-header">
                    <h1 id="results-heading">Election Results</h1>
                    <div class="export-actions">
                        <button class="btn btn-outline" aria-label="Export results as PDF" id="exportPdf">
                            <i class="fas fa-file-pdf" aria-hidden="true"></i> Export PDF
                        </button>
                        <button class="btn btn-outline" aria-label="Export results as CSV" id="exportCsv">
                            <i class="fas fa-file-excel" aria-hidden="true"></i> Export CSV
                        </button>
                        <button class="btn btn-outline" aria-label="Print results" id="printResults">
                            <i class="fas fa-print" aria-hidden="true"></i> Print
                        </button>
                    </div>
                </div>

                <div class="results-filter">
                    <label for="electionSelect" class="sr-only">Select election</label>
                    <select class="election-select" id="electionSelect">
                        <option value="">Select an election</option>
                        <option th:each="election : ${pastElections}" 
                                th:value="${election.id}" 
                                th:text="${election.title + ' (' + #temporals.format(election.endDate, 'yyyy') + ')'}">
                            Student Council Election 2024
                        </option>
                    </select>
                </div>

                <div class="results-container" th:if="${selectedElection != null}">
                    <div class="results-summary">
                        <article class="summary-card">
                            <h3>Total Votes</h3>
                            <div class="summary-value" th:text="${selectedElection.totalVotes}">782</div>
                            <div class="summary-meta" th:text="${selectedElection.participationRate} + '% participation'">62% participation</div>
                        </article>
                        <article class="summary-card">
                            <h3>Valid Votes</h3>
                            <div class="summary-value" th:text="${selectedElection.validVotes}">765</div>
                            <div class="summary-meta" th:text="${#numbers.formatDecimal(selectedElection.validVotes/selectedElection.totalVotes*100, 1, 1)} + '% of total'">97.8% of total</div>
                        </article>
                        <article class="summary-card">
                            <h3>Invalid Votes</h3>
                            <div class="summary-value" th:text="${selectedElection.invalidVotes}">17</div>
                            <div class="summary-meta" th:text="${#numbers.formatDecimal(selectedElection.invalidVotes/selectedElection.totalVotes*100, 1, 1)} + '% of total'">2.2% of total</div>
                        </article>
                    </div>

                    <div class="results-chart">
                        <div class="chart-header">
                            <h3 th:text="${selectedElection.mainPosition} + ' - Vote Distribution'">President - Vote Distribution</h3>
                            <div class="chart-legend" role="list">
                                <th:block th:each="candidate : ${selectedElection.candidates}">
                                    <div class="legend-item" role="listitem">
                                        <span class="legend-color" th:style="'background-color: ' + ${candidate.color} + ';'"></span>
                                        <span th:text="${candidate.name} + ' (' + ${candidate.percentage} + '%)'">Michael Chen (43.7%)</span>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                        <div class="chart-container" role="img" aria-label="Vote distribution chart">
                            <canvas id="resultsChart" width="400" height="200"></canvas>
                            <noscript>
                                <p>Vote distribution: 
                                    <th:block th:each="candidate : ${selectedElection.candidates}">
                                        <span th:text="${candidate.name} + ' ' + ${candidate.percentage} + '%'">Michael Chen 43.7%</span>
                                        <span th:unless="${candidateStat.last}">, </span>
                                    </th:block>
                                </p>
                            </noscript>
                        </div>
                    </div>

                    <div class="results-table">
                        <table aria-describedby="resultsTableDesc">
                            <caption id="resultsTableDesc" class="sr-only">Election results by position</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Position</th>
                                    <th scope="col">Winner</th>
                                    <th scope="col">Votes</th>
                                    <th scope="col">Percentage</th>
                                    <th scope="col">Margin</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="position : ${selectedElection.positions}">
                                    <th scope="row" th:text="${position.name}">President</th>
                                    <td>
                                        <div class="candidate-info">
                                            <img th:src="${position.winnerImageUrl}" alt="Winner photo">
                                            <span th:text="${position.winnerName}">Michael Chen</span>
                                        </div>
                                    </td>
                                    <td th:text="${position.winnerVotes}">342</td>
                                    <td th:text="${position.winnerPercentage} + '%'">43.7%</td>
                                    <td th:text="'+' + ${position.voteMargin} + ' votes'">+53 votes</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-content" class="content-section" aria-labelledby="settings-heading">
            <div class="section-header">
                <h3 id="settings-heading" class="section-title">
                    <i class="fas fa-cog" aria-hidden="true"></i> Settings
                </h3>
            </div>
            <div class="settings-content">
                <div class="settings-tabs" role="tablist" aria-label="Settings tabs">
                    <button class="settings-tab active" data-tab="account" role="tab" aria-selected="true" aria-controls="account-tab">Account</button>
                    <button class="settings-tab" data-tab="security" role="tab" aria-selected="false" aria-controls="security-tab">Security</button>
                    <button class="settings-tab" data-tab="notifications" role="tab" aria-selected="false" aria-controls="notifications-tab">Notifications</button>
                    <button class="settings-tab" data-tab="system" role="tab" aria-selected="false" aria-controls="system-tab">System</button>
                </div>

                <div class="settings-tab-content active" id="account-tab" role="tabpanel" aria-labelledby="account-tab" data-tab="account">
                    <div class="settings-card">
                        <h4><i class="fas fa-user-shield" aria-hidden="true"></i> Account Settings</h4>
                        <form th:action="@{/settings/account}" method="post" class="settings-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" th:value="${user.username}" readonly>
                            </div>
                            <div class="form-group">
                                <label for="fullname">Full Name</label>
                                <div class="name-fields">
                                    <input type="text" id="firstName" name="firstName" th:value="${user.firstName}" placeholder="First Name" required>
                                    <input type="text" id="lastName" name="lastName" th:value="${user.lastName}" placeholder="Last Name" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" th:value="${user.email}" required>
                            </div>
                            <div class="form-group">
                                <label>Profile Photo</label>
                                <div class="file-upload">
                                    <img th:src="@{${user.profileImageUrl != null} ? ${user.profileImageUrl} : '/images/default-profile.png'}" 
                                         alt="Current profile" 
                                         class="profile-preview"
                                         id="profilePreview">
                                    <div class="upload-actions">
                                        <input type="file" id="profileImage" name="profileImage" accept="image/*" class="d-none">
                                        <button type="button" class="btn btn-outline btn-sm" id="changeProfileBtn">
                                            <i class="fas fa-camera" aria-hidden="true"></i> Change
                                        </button>
                                        <button type="button" class="btn btn-outline btn-sm" id="removeProfileBtn">
                                            <i class="fas fa-trash" aria-hidden="true"></i> Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Account</button>
                        </form>
                    </div>
                </div>

                <div class="settings-tab-content" id="security-tab" role="tabpanel" aria-labelledby="security-tab" data-tab="security">
                    <div class="settings-card">
                        <h4><i class="fas fa-lock" aria-hidden="true"></i> Security</h4>
                        <form th:action="@{/settings/security}" method="post" class="settings-form">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" name="currentPassword" placeholder="Enter current password" required>
                                <div class="invalid-feedback">Please provide your current password</div>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" name="newPassword" placeholder="Enter new password" required>
                                <div class="password-strength">
                                    <span class="strength-bar"></span>
                                    <span class="strength-text">Weak</span>
                                </div>
                                <small class="form-text">Password must be at least 8 characters long</small>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm new password" required>
                                <div class="invalid-feedback">Passwords do not match</div>
                            </div>
                            <div class="form-group">
                                <label for="2fa-toggle">Two-Factor Authentication</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="2fa-toggle" name="twoFactorEnabled" th:checked="${user.twoFactorEnabled}">
                                    <label for="2fa-toggle"></label>
                                    <span th:text="${user.twoFactorEnabled} ? 'Enabled' : 'Disabled'">Enabled</span>
                                </div>
                                <small class="form-text">Add an extra layer of security to your account</small>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Security Settings</button>
                        </form>
                    </div>
                </div>

                <div class="settings-tab-content" id="notifications-tab" role="tabpanel" aria-labelledby="notifications-tab" data-tab="notifications">
                    <div class="settings-card">
                        <h4><i class="fas fa-bell" aria-hidden="true"></i> Notification Preferences</h4>
                        <form th:action="@{/settings/notifications}" method="post" class="settings-options">
                            <div class="option-group">
                                <h5>Email Notifications</h5>
                                <div class="option-item">
                                    <input type="checkbox" id="email-election" name="emailElection" th:checked="${user.notificationPreferences.emailElection}">
                                    <label for="email-election">Election updates</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="email-results" name="emailResults" th:checked="${user.notificationPreferences.emailResults}">
                                    <label for="email-results">Election results</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="email-system" name="emailSystem" th:checked="${user.notificationPreferences.emailSystem}">
                                    <label for="email-system">System notifications</label>
                                </div>
                            </div>
                            <div class="option-group">
                                <h5>In-App Notifications</h5>
                                <div class="option-item">
                                    <input type="checkbox" id="app-new-voter" name="appNewVoter" th:checked="${user.notificationPreferences.appNewVoter}">
                                    <label for="app-new-voter">New voter registrations</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="app-new-candidate" name="appNewCandidate" th:checked="${user.notificationPreferences.appNewCandidate}">
                                    <label for="app-new-candidate">New candidate applications</label>
                                </div>
                                <div class="option-item">
                                    <input type="checkbox" id="app-vote-activity" name="appVoteActivity" th:checked="${user.notificationPreferences.appVoteActivity}">
                                    <label for="app-vote-activity">Vote activity</label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Preferences</button>
                        </form>
                    </div>
                </div>

                <div class="settings-tab-content" id="system-tab" role="tabpanel" aria-labelledby="system-tab" data-tab="system">
                    <div class="settings-card">
                        <h4><i class="fas fa-server" aria-hidden="true"></i> System Settings</h4>
                        <form th:action="@{/settings/system}" method="post" class="settings-form">
                            <div class="form-group">
                                <label for="timezone">Timezone</label>
                                <select id="timezone" name="timezone" th:value="${systemSettings.timezone}">
                                    <option th:each="tz : ${timezones}" 
                                            th:value="${tz.id}" 
                                            th:text="${tz.displayName}"
                                            th:selected="${tz.id == systemSettings.timezone}">
                                        (UTC-05:00) Eastern Time (US & Canada)
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dateFormat">Date Format</label>
                                <select id="dateFormat" name="dateFormat" th:value="${systemSettings.dateFormat}">
                                    <option th:each="format : ${dateFormats}" 
                                            th:value="${format}" 
                                            th:text="${format}"
                                            th:selected="${format == systemSettings.dateFormat}">
                                        MM/DD/YYYY
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="resultsVisibility">Results Visibility</label>
                                <select id="resultsVisibility" name="resultsVisibility" th:value="${systemSettings.resultsVisibility}">
                                    <option th:each="visibility : ${visibilityOptions}" 
                                            th:value="${visibility.key}" 
                                            th:text="${visibility.value}"
                                            th:selected="${visibility.key == systemSettings.resultsVisibility}">
                                        Show after election ends
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="electionDuration">Default Election Duration</label>
                                <div class="input-group">
                                    <input type="number" id="electionDuration" name="electionDuration" 
                                           th:value="${systemSettings.defaultElectionDuration}" min="1" max="30">
                                    <span class="input-group-text">Days</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="maxCandidates">Max Candidates Per Position</label>
                                <input type="number" id="maxCandidates" name="maxCandidates" 
                                       th:value="${systemSettings.maxCandidatesPerPosition}" min="1" max="20">
                            </div>
                            <button type="submit" class="btn btn-primary">Save System Settings</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Add Candidate Modal -->
<div class="modal fade" id="addCandidateModal" tabindex="-1" role="dialog" aria-labelledby="addCandidateModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCandidateModalTitle">Add New Candidate</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="candidateForm" th:action="@{/candidates}" method="post" novalidate enctype="multipart/form-data">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="firstname" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstname" name="firstName" required>
                            <div class="invalid-feedback">Please provide a first name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="lastname" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastname" name="lastName" required>
                            <div class="invalid-feedback">Please provide a last name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="birthdate" class="form-label">Birthdate</label>
                            <input type="date" class="form-control" id="birthdate" name="birthDate">
                        </div>
                        <div class="col-md-6">
                            <label for="gender" class="form-label">Gender</label>
                            <select class="form-select" id="gender" name="gender">
                                <option value="">Select Gender</option>
                                <option th:each="gender : ${genders}" 
                                        th:value="${gender}" 
                                        th:text="${gender}">
                                    Male
                                </option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="party" class="form-label">Political Party</label>
                            <input type="text" class="form-control" id="party" name="party">
                        </div>
                        <div class="col-md-6">
                            <label for="election" class="form-label">Election</label>
                            <select class="form-select" id="election" name="electionId">
                                <option value="">Select Election</option>
                                <option th:each="election : ${activeElections}" 
                                        th:value="${election.id}" 
                                        th:text="${election.title}">
                                </option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="region" class="form-label">Region</label>
                            <input type="text" class="form-control" id="region" name="region">
                        </div>
                        <div class="col-md-4">
                            <label for="department" class="form-label">Department</label>
                            <input type="text" class="form-control" id="department" name="department">
                        </div>
                        <div class="col-md-4">
                            <label for="arron" class="form-label">Arron</label>
                            <input type="text" class="form-control" id="arron" name="arron">
                        </div>
                        <div class="col-12">
                            <label for="location" class="form-label">Location</label>
                            <input type="text" class="form-control" id="location" name="location">
                        </div>
                        <div class="col-12">
                            <label for="biography" class="form-label">Biography</label>
                            <textarea class="form-control" id="biography" name="biography" rows="3"></textarea>
                        </div>
                        <div class="col-12">
                            <label for="candidatePhoto" class="form-label">Candidate Photo</label>
                            <input type="file" class="form-control" id="candidatePhoto" name="photo" accept="image/*">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="candidateForm" class="btn btn-primary">Save Candidate</button>
            </div>
        </div>
    </div>
</div>

<!-- Create Election Modal -->
<div class="modal fade" id="createElectionModal" tabindex="-1" role="dialog" aria-labelledby="createElectionModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createElectionModalTitle">Create New Election</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="electionForm" th:action="@{/elections}" method="post" novalidate enctype="multipart/form-data">
                    <div class="row g-3">
                        <div class="col-md-12">
                            <label for="electionTitle" class="form-label">Election Title</label>
                            <input type="text" class="form-control" id="electionTitle" name="title" required>
                            <div class="invalid-feedback">Please provide a title for the election</div>
                        </div>
                        <div class="col-md-12">
                            <label for="electionDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="electionDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="col-md-6">
                            <label for="electionStartDate" class="form-label">Start Date</label>
                            <input type="datetime-local" class="form-control" id="electionStartDate" name="startDate" required>
                            <div class="invalid-feedback">Please select a start date</div>
                        </div>
                        <div class="col-md-6">
                            <label for="electionEndDate" class="form-label">End Date</label>
                            <input type="datetime-local" class="form-control" id="electionEndDate" name="endDate" required>
                            <div class="invalid-feedback">Please select an end date</div>
                        </div>
                        <div class="col-md-6">
                            <label for="electionType" class="form-label">Election Type</label>
                            <select class="form-select" id="electionType" name="type">
                                <option th:each="type : ${electionTypes}" 
                                        th:value="${type.key}" 
                                        th:text="${type.value}">
                                    Single Choice
                                </option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="eligibleVoters" class="form-label">Eligible Voters</label>
                            <select class="form-select" id="eligibleVoters" name="eligibleGroups" multiple>
                                <option th:each="group : ${voterGroups}" 
                                        th:value="${group.id}" 
                                        th:text="${group.name}">
                                    All registered voters
                                </option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label for="electionBanner" class="form-label">Election Banner</label>
                            <input type="file" class="form-control" id="electionBanner" name="bannerImage" accept="image/*">
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="resultsPublic" name="resultsPublic">
                                <label class="form-check-label" for="resultsPublic">
                                    Make results public immediately after election ends
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="electionForm" class="btn btn-primary">Create Election</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Vote Office Modal -->
<div class="modal fade" id="addOfficeModal" tabindex="-1" role="dialog" aria-labelledby="addOfficeModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addOfficeModalTitle">Add New Vote Office</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="officeForm" th:action="@{/offices}" method="post" novalidate>
                    <div class="row g-3">
                        <div class="col-md-12">
                            <label for="officeName" class="form-label">Office Name</label>
                            <input type="text" class="form-control" id="officeName" name="name" required>
                            <div class="invalid-feedback">Please provide an office name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="officeRegion" class="form-label">Region</label>
                            <select class="form-select" id="officeRegion" name="region" required>
                                <option value="">Select Region</option>
                                <option th:each="region : ${regions}" th:value="${region}">[[${region}]]</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="officeDepartment" class="form-label">Department</label>
                            <input type="text" class="form-control" id="officeDepartment" name="department">
                        </div>
                        <div class="col-12">
                            <label for="officeAddress" class="form-label">Address</label>
                            <textarea class="form-control" id="officeAddress" name="address" rows="2"></textarea>
                        </div>
                        <div class="col-md-6">
                            <label for="officePhone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="officePhone" name="phone">
                        </div>
                        <div class="col-md-6">
                            <label for="officeEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="officeEmail" name="email">
                        </div>
                        <div class="col-12">
                            <label for="officeHours" class="form-label">Operating Hours</label>
                            <input type="text" class="form-control" id="officeHours" name="hours" placeholder="e.g., Mon-Fri 8:00 AM - 5:00 PM">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="officeForm" class="btn btn-primary">Save Office</button>
            </div>
        </div>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="logoutModalTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="logoutModalTitle">Confirm Logout</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to logout from your account?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form th:action="@{/logout}" method="post">
                    <button type="submit" class="btn btn-primary" id="confirmLogout">Logout</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script th:src="@{/js/dash.js}"></script>
<script src="../static/js/dash.js"></script>
</body>
</html>